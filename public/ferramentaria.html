<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Ferramentaria</title>
  <link rel="icon" type="image/x-icon" href="./icone.ico">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f5f7;
      margin: 0;
      font-size: 13px;
      display: flex;
    }
    .sidebar {
      width: 220px;
      background: #fff;
      color: #222e3c;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      display: flex;
      flex-direction: column;
      padding: 24px 0 0 0;
      box-shadow: 2px 0 8px rgba(0,0,0,0.08);
      z-index: 10;
      transition: width 0.3s;
      overflow: hidden;
    }
    .sidebar.closed {
      width: 60px;
    }
    .sidebar .logo {
      width: 100%;
      text-align: center;
      margin-bottom: 24px;
      transition: all 0.3s;
    }
    .sidebar .logo img {
      width: 140px;
      transition: width 0.3s, opacity 0.3s;
    }
    .sidebar.closed .logo img {
      display: none;
    }
    .sidebar nav {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-left: 24px;
      transition: all 0.3s;
    }
    .sidebar a {
      color: #222e3c;
      text-decoration: none;
      font-size: 15px;
      padding: 6px 0;
      border-radius: 4px;
      transition: background 0.2s;
      display: flex;
      align-items: center;
    }
    .sidebar a:hover {
      background: #f4f5f7;
    }
    .sidebar a img {
      width: 18px;
      height: 18px;
      margin-right: 12px;
      filter: grayscale(100%);
      transition: margin 0.3s, width 0.3s, height 0.3s;
    }
    .sidebar.closed nav {
      margin-left: 0;
      align-items: center;
    }
    .sidebar.closed nav a {
      justify-content: center;
      font-size: 0;
      padding: 8px 0;
    }
    .sidebar.closed nav a img {
      margin: 0;
      width: 24px;
      height: 24px;
      filter: grayscale(0%);
    }
    .sidebar-toggle {
      margin-top: auto;
      width: 100%;
      background: none;
      border: none;
      color: #222e3c;
      font-size: 22px;
      cursor: pointer;
      padding: 12px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
      position: absolute;
      left: 0;
      bottom: 32px;
      border-radius: 0 0 0 8px;
    }
    .sidebar-toggle:hover {
      background: #f4f5f7;
    }
    .sidebar.closed .sidebar-toggle {
      width: 60px;
    }
    .main-content {
      margin-left: 220px;
      width: calc(100vw - 220px);
      padding: 20px;
      transition: margin-left 0.3s, width 0.3s;
    }
    .sidebar.closed ~ .main-content {
      margin-left: 60px;
      width: calc(100vw - 60px);
    }
    h2 {
      margin-bottom: 10px;
      font-size: 18px;
    }
    /* Tabela Ferramentaria */
    .ferramentaria-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      border-radius: 12px;
      overflow: hidden;
    }
    .ferramentaria-table thead tr {
      background: linear-gradient(90deg, #007bff 0%, #00c2e0 100%);
    }
    .ferramentaria-table th {
      color: #fff;
      font-weight: bold;
      padding: 12px 14px;
      font-size: 15px;
      border: none;
    }
    .ferramentaria-table th:first-child {
      border-top-left-radius: 12px;
    }
    .ferramentaria-table th:last-child {
      border-top-right-radius: 12px;
    }
    .ferramentaria-table td {
      border: 1px solid #e0e0e0;
      padding: 10px 12px;
      font-size: 14px;
      color: #222;
      background: #fff;
      text-align: center;
      height: 32px;
    }
    .ferramentaria-table tr:not(:last-child) td {
      border-bottom: 1px solid #e0e0e0;
    }
  </style>
</head>
<body>
  <div class="sidebar closed" id="sidebar">
    <div class="logo">
      <img src="./logo.png" alt="Logo">
    </div>
    <hr style="border: none; border-top: 1px solid #e0e0e0; margin: 0 24px 18px 24px;">
    <nav>
      <a href="./index.html">
        <img src="./icons/house-chimney.svg" alt="Dashboard">
        <span>Início</span>
      </a>
      <a href="./producao.html" id="producaoLink">
        <img src="./icons/industry-windows.svg" alt="Dashboard">
        <span>Painel Fabrica</span>
      </a>
      <a href="./ferramentaria.html">
        <img src="./icons/robotic-arm.svg" alt="Dashboard">
        <span>Ferramentaria</span>
      </a>
      <a href="./vendas.html" id="vendasLink">
        <img src="./icons/search-dollar.svg" alt="Relatórios">
        <span>Vendas</span>
      </a>
    </nav>
    <button class="sidebar-toggle" id="sidebarToggle" title="Abrir/Fechar menu">
      <span id="toggleIcon">&gt;</span>
    </button>
  </div>
  <div class="main-content" id="mainContent">
    <div style="display: flex; align-items: center; gap: 24px; margin-bottom: 10px; justify-content: space-between; position: relative;">
        <img src="logo.png" alt="Logo" style="height: 58px; margin-right: 18px; margin-left: 0;" />
        <div style="display: flex; align-items: center; gap: 8px;">
          <input id="searchBar" type="text" placeholder="Pesquisar código ou descrição..." style="padding: 8px 14px; font-size: 15px; border: 1px solid #ccc; border-radius: 6px; width: 240px;" autocomplete="off">
          <div id="suggestions" style="position: absolute; z-index: 10; background: #fff; border: 1px solid #ccc; border-radius: 0 0 6px 6px; width: 240px; max-height: 180px; overflow-y: auto; display: none;"></div>
          <button id="btnSearch" style="padding: 8px 18px; font-size: 15px; border: none; border-radius: 6px; background: #0079bf; color: #fff; font-weight: bold; cursor: pointer; margin-right: 8px;">Buscar</button>
        </div>
    </div>
    <h2>Ferramentaria</h2>
    <div style="max-width: 1000px; margin: 0 auto 18px auto; display: flex; justify-content: flex-end; align-items: center; gap: 12px;">
      <button id="btnNovo" style="padding: 8px 18px; font-size: 15px; border: none; border-radius: 6px; background: #28a745; color: #fff; font-weight: bold; cursor: pointer; transition: background 0.2s;">Novo</button>
      <button id="btnEditar" style="padding: 8px 18px; font-size: 15px; border: none; border-radius: 6px; background: #007bff; color: #fff; font-weight: bold; cursor: pointer; transition: background 0.2s;">Editar</button>
    </div>
    <div style="overflow-x:auto; margin-top: 24px;">
      <table class="ferramentaria-table" id="tabelaFerramentaria">
        <thead>
          <tr>
            <th>N° OS</th>
            <th>Data Abertura</th>
            <th>Cod. Peça</th>
            <th>N° Molde</th>
            <th>Obs</th>
            <th>Setor Solicitante</th>
            <th>Data Limite Entrega</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
    <div id="containerSalvar" style="max-width: 1000px; margin: 18px auto 0 auto; display: flex; justify-content: flex-end; align-items: center;">
    </div>
  </div>
  <script>
    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('sidebarToggle');
    const toggleIcon = document.getElementById('toggleIcon');
    toggleBtn.addEventListener('click', () => {
      sidebar.classList.toggle('closed');
      toggleIcon.innerHTML = sidebar.classList.contains('closed') ? '&gt;' : '&lt;';
    });

    // Adiciona funcionalidade ao botão Novo
    document.getElementById('btnNovo').addEventListener('click', function() {
      const btnEditar = document.getElementById('btnEditar');
      if (btnEditar) btnEditar.style.display = 'none';
      const tabela = document.getElementById('tabelaFerramentaria').getElementsByTagName('tbody')[0];
      // Evita múltiplas linhas abertas
      if (document.getElementById('linhaNova')) return;
      const linha = document.createElement('tr');
      linha.id = 'linhaNova';
      const campos = ['os', 'abertura', 'peca', 'molde', 'obs', 'setor', 'limite', 'status'];
      campos.forEach((campo, idx) => {
        const td = document.createElement('td');
        if (campo === 'obs') {
          // Botão para abrir bloco de notas
          const btnObs = document.createElement('button');
          btnObs.textContent = 'Adicionar';
          btnObs.style.padding = '6px 12px';
          btnObs.style.fontSize = '14px';
          btnObs.style.border = 'none';
          btnObs.style.borderRadius = '6px';
          btnObs.style.background = '#ffc107';
          btnObs.style.color = '#222';
          btnObs.style.fontWeight = 'bold';
          btnObs.style.cursor = 'pointer';
          btnObs.style.transition = 'background 0.2s';
          td.appendChild(btnObs);
          // Modal bloco de notas
          btnObs.addEventListener('click', function() {
            let modal = document.getElementById('modalObs');
            if (!modal) {
              modal = document.createElement('div');
              modal.id = 'modalObs';
              modal.style.position = 'fixed';
              modal.style.top = '0';
              modal.style.left = '0';
              modal.style.width = '100vw';
              modal.style.height = '100vh';
              modal.style.background = 'rgba(0,0,0,0.3)';
              modal.style.display = 'flex';
              modal.style.alignItems = 'center';
              modal.style.justifyContent = 'center';
              modal.style.zIndex = '9999';
              // Conteúdo do modal
              const box = document.createElement('div');
              box.style.background = '#fff';
              box.style.borderRadius = '12px';
              box.style.padding = '24px';
              box.style.boxShadow = '0 2px 16px rgba(0,0,0,0.18)';
              box.style.minWidth = '540px';
              box.style.maxWidth = '98vw';
              box.style.display = 'flex';
              box.style.flexDirection = 'column';
              box.style.gap = '16px';
              const label = document.createElement('label');
              label.textContent = 'Observação:';
              label.style.fontWeight = 'bold';
              label.style.marginBottom = '8px';
              const textarea = document.createElement('textarea');
              textarea.style.width = '100%';
              textarea.style.height = '220px';
              textarea.style.fontSize = '15px';
              textarea.style.padding = '8px';
              textarea.style.borderRadius = '6px';
              textarea.style.border = '1px solid #ccc';
              textarea.style.resize = 'vertical';
              textarea.value = btnObs.dataset.obs || '';
              const btnSalvarObs = document.createElement('button');
              btnSalvarObs.textContent = 'Salvar Obs';
              btnSalvarObs.style.padding = '8px 18px';
              btnSalvarObs.style.fontSize = '15px';
              btnSalvarObs.style.border = 'none';
              btnSalvarObs.style.borderRadius = '6px';
              btnSalvarObs.style.background = '#007bff';
              btnSalvarObs.style.color = '#fff';
              btnSalvarObs.style.fontWeight = 'bold';
              btnSalvarObs.style.cursor = 'pointer';
              btnSalvarObs.style.transition = 'background 0.2s';
              btnSalvarObs.style.marginRight = '10px';
              const btnFecharObs = document.createElement('button');
              btnFecharObs.textContent = 'Fechar';
              btnFecharObs.style.padding = '8px 18px';
              btnFecharObs.style.fontSize = '15px';
              btnFecharObs.style.border = 'none';
              btnFecharObs.style.borderRadius = '6px';
              btnFecharObs.style.background = '#dc3545';
              btnFecharObs.style.color = '#fff';
              btnFecharObs.style.fontWeight = 'bold';
              btnFecharObs.style.cursor = 'pointer';
              btnFecharObs.style.transition = 'background 0.2s';
              btnFecharObs.style.marginLeft = '10px';
              const btns = document.createElement('div');
              btns.style.display = 'flex';
              btns.style.justifyContent = 'flex-end';
              btns.appendChild(btnSalvarObs);
              btns.appendChild(btnFecharObs);
              box.appendChild(label);
              box.appendChild(textarea);
              box.appendChild(btns);
              modal.appendChild(box);
              document.body.appendChild(modal);
              btnFecharObs.onclick = () => modal.remove();
              btnSalvarObs.onclick = () => {
                btnObs.dataset.obs = textarea.value;
                btnObs.textContent = textarea.value ? 'Obs adicionada' : 'Adicionar Obs';
                modal.remove();
              };
            }
          });
        } else if (campo === 'limite') {
          let input = document.createElement('input');
          input.type = 'date';
          input.style.width = '100%';
          input.style.padding = '6px';
          input.style.fontSize = '14px';
          input.style.boxSizing = 'border-box';
          input.placeholder = document.querySelectorAll('.ferramentaria-table th')[idx].textContent;
          // Força abrir o calendário ao clicar
          input.addEventListener('click', function(e) {
            this.showPicker && this.showPicker();
          });
          td.appendChild(input);
        } else if (campo === 'setor') {
          const select = document.createElement('select');
          select.style.width = '100%';
          select.style.padding = '6px';
          select.style.fontSize = '14px';
          select.style.boxSizing = 'border-box';
          select.style.borderRadius = '6px';
          select.style.border = '1px solid #ccc';
          const opcoes = ['', 'PCP', 'Qualidade', 'Produção', 'Diretoria', 'Ferramentaria'];
          opcoes.forEach(op => {
            const option = document.createElement('option');
            option.value = op;
            option.textContent = op ? op : 'Selecione...';
            select.appendChild(option);
          });
          td.appendChild(select);
        } else if (campo === 'status') {
          const select = document.createElement('select');
          select.style.width = '100%';
          select.style.padding = '6px';
          select.style.fontSize = '14px';
          select.style.boxSizing = 'border-box';
          select.style.borderRadius = '6px';
          select.style.border = '1px solid #ccc';
          const opcoes = ['', 'Liberada', 'Em Andamento', 'Concluído'];
          opcoes.forEach(op => {
            const option = document.createElement('option');
            option.value = op;
            option.textContent = op ? op : 'Selecione...';
            select.appendChild(option);
          });
          td.appendChild(select);
        } else {
          let input = document.createElement('input');
          input.type = 'text';
          input.style.width = '100%';
          input.style.padding = '6px';
          input.style.fontSize = '14px';
          input.style.boxSizing = 'border-box';
          input.placeholder = document.querySelectorAll('.ferramentaria-table th')[idx].textContent;
          td.appendChild(input);
        }
        linha.appendChild(td);
      });
      tabela.appendChild(linha);
      // Adiciona botão salvar
      const containerSalvar = document.getElementById('containerSalvar');
      containerSalvar.innerHTML = '';
      const btnSalvar = document.createElement('button');
      btnSalvar.id = 'btnSalvar';
      btnSalvar.textContent = 'Salvar';
      btnSalvar.style.padding = '8px 18px';
      btnSalvar.style.fontSize = '15px';
      btnSalvar.style.border = 'none';
      btnSalvar.style.borderRadius = '6px';
      btnSalvar.style.background = '#007bff';
      btnSalvar.style.color = '#fff';
      btnSalvar.style.fontWeight = 'bold';
      btnSalvar.style.cursor = 'pointer';
      btnSalvar.style.transition = 'background 0.2s';
      containerSalvar.appendChild(btnSalvar);
      // Botão cancelar
      const btnCancelar = document.createElement('button');
      btnCancelar.id = 'btnCancelar';
      btnCancelar.textContent = 'Cancelar';
      btnCancelar.style.padding = '8px 18px';
      btnCancelar.style.fontSize = '15px';
      btnCancelar.style.border = 'none';
      btnCancelar.style.borderRadius = '6px';
      btnCancelar.style.background = '#dc3545';
      btnCancelar.style.color = '#fff';
      btnCancelar.style.fontWeight = 'bold';
      btnCancelar.style.cursor = 'pointer';
      btnCancelar.style.transition = 'background 0.2s';
      btnCancelar.style.marginLeft = '10px';
      containerSalvar.appendChild(btnCancelar);
      btnSalvar.addEventListener('click', function() {
        // Corrige coleta dos valores
        const valores = [];
        linha.childNodes.forEach((td, idx) => {
          // Obs
          if (idx === 4) {
            const btnObs = td.querySelector('button');
            valores.push(btnObs ? (btnObs.dataset.obs || '') : '');
          }
          // Setor Solicitante
          else if (idx === 5) {
            const select = td.querySelector('select');
            valores.push(select ? select.value : '');
          }
          // Data Limite Entrega
          else if (idx === 6) {
            const input = td.querySelector('input[type="date"]');
            valores.push(input ? input.value : '');
          }
          // Status
          else if (idx === 7) {
            const select = td.querySelector('select');
            valores.push(select ? select.value : '');
          }
          // Demais campos
          else {
            const input = td.querySelector('input');
            valores.push(input ? input.value : '');
          }
        });
        // Substitui a linha de inputs por uma linha de texto
        linha.innerHTML = valores.map(v => `<td>${v}</td>`).join('');
        linha.id = '';
        containerSalvar.innerHTML = '';
        if (btnEditar) btnEditar.style.display = '';
      });
      btnCancelar.addEventListener('click', function() {
        linha.remove();
        containerSalvar.innerHTML = '';
        if (btnEditar) btnEditar.style.display = '';
      });
    });
  </script>
</body>
</html>
